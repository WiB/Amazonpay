<!-- Place this code in your HTML where you would like the address widget to appear. -->
<div id="addressBookWidgetDiv"> </div>

<!-- Place this code in your HTML where you would like the wallet widget to appear. -->
<div id="walletWidgetDiv"> </div>

<style>
    #addressBookWidgetDiv {
        min-width: 300px;
        width: 100%;
        max-width: 900px;
        min-height: 228px;
        height: 240px;
        max-height: 400px;
    }

    #walletWidgetDiv {
        min-width: 300px;
        width: 100%;
        max-width: 900px;
        min-height: 228px;
        height: 240px;
        max-height: 400px;
    }
</style>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script> {#@todo shouldn't be done this way#}
<script>
    window.onAmazonLoginReady = function() {
        amazon.Login.setClientId('{{ amazonConfig.clientId }}');
    };

    window.onAmazonPaymentsReady = function() {
        new OffAmazonPayments.Widgets.AddressBook({
            sellerId: '{{ amazonConfig.sellerId }}',
            scope: 'profile postal_code payments:widget payments:shipping_address payments:billing_address',
            language: 'en-GB',
            onOrderReferenceCreate: function(orderReference) {
                console.log(orderReference);

                // Here is where you can grab the Order Reference ID.
                var aoid = orderReference.getAmazonOrderReferenceId();

                $.post(
                    '{{ path('amazonpay_set_order_reference') }}',
                    {'reference_id': aoid},
                    function (data) {
                        console.log(data);
                    }
                );
            },
            onAddressSelect: function(orderReference) {
                $('#amazonpay_place_order_link').attr('disabled', true);
                $('#shipment_methods').html('Please wait...');
                $('#shipment_methods').load(
                    '{{ path('amazonpay_get_shipment_methods') }}',
                    function( response, status, xhr ) {
                        if ( status == "error" ) {
                            var msg = "Sorry but there was an error: ";
                            $( "#shipment_methods" ).html( msg + xhr.status + " " + xhr.statusText );
                        }
                    }
                );
            },
            design: {
                designMode: 'responsive'
            },
            onReady: function(orderReference) {
                // Enter code here you want to be executed
                // when the address widget has been rendered.
            },
            onError: function(error) {
            }
        }).bind("addressBookWidgetDiv");

        new OffAmazonPayments.Widgets.Wallet({
            sellerId: '{{ amazonConfig.sellerId }}',
            scope: 'profile postal_code payments:widget payments:shipping_address',
            onPaymentSelect: function(orderReference) {
                // Replace this code with the action that you want to perform
                // after the payment method is selected.

                // Ideally this would enable the next action for the buyer
                // including either a "Continue" or "Place Order" button.
            },
            design: {
                designMode: 'responsive'
            },
            onError: function(error) {
            }
        }).bind("walletWidgetDiv");
    };
</script>

<script async="async"
        src='https://static-eu.payments-amazon.com/OffAmazonPayments/eur/sandbox/lpa/js/Widgets.js'>
</script>